ä»¥ä¸‹æ˜¯ä¸º**å…¨åŸºå› ç»„é‡æµ‹åºåˆ†æï¼ˆWGSï¼‰**æ•´åˆæ„å»º Conda ç¯å¢ƒçš„å®Œæ•´å‘½ä»¤ï¼Œæ¶µç›–äº†ä»**æ•°æ®è´¨æ§**ã€**æ¯”å¯¹**ã€**å˜å¼‚æ£€æµ‹**åˆ°**SNPæ³¨é‡Š**çš„ä¸»æµå·¥å…·ï¼Œé€‚ç”¨äº**äººç±»æˆ–éæ¨¡å¼ç”Ÿç‰©ï¼ˆå¦‚ç»µç¾Šï¼‰**ã€‚

---

## âœ… Conda åˆ›å»ºæ•´åˆç¯å¢ƒå‘½ä»¤ï¼š

```bash
conda create -n wgs \
  -c bioconda -c conda-forge \
  fastp \
  multiqc \
  bwa \
  minimap2 \
  samtools \
  picard \
  bedtools \
  htslib \
  gatk4 \
  bcftools \
  freebayes \
  vcftools \
  plink \
  snpeff \
  snpsift \
  ensembl-vep
```

---

## ğŸ§° å·¥å…·åŠŸèƒ½æ¦‚è§ˆï¼š

| ç±»åˆ«    | å·¥å…·                                 | åŠŸèƒ½è¯´æ˜             |
| ----- | ---------------------------------- | ---------------- |
| è´¨æ§ QC | fastp, multiqc                     | è´¨æ§ã€è¿‡æ»¤ã€æ±‡æ€»æŠ¥å‘Š       |
| æ¯”å¯¹    | bwa, minimap2                      | WGSè¯»å–åˆ°å‚è€ƒåŸºå› ç»„çš„æ¯”å¯¹   |
| BAMå¤„ç† | samtools, picard, bedtools, htslib | æ’åºã€å»é‡ã€æå–åŒºåŸŸã€æ·±åº¦ç»Ÿè®¡ç­‰ |
| å˜å¼‚æ£€æµ‹  | gatk4, freebayes, bcftools         | æ£€æµ‹SNP/InDelå˜å¼‚    |
| VCFå¤„ç† | vcftools, plink, bcftools          | å˜å¼‚æ ¼å¼è¿‡æ»¤ã€ç»Ÿè®¡ã€ç¾¤ä½“åˆ†æ   |
| SNPæ³¨é‡Š | snpeff, snpsift, ensembl-vep       | SNPåŠŸèƒ½æ³¨é‡Šï¼Œå½±å“é¢„æµ‹     |

---

## ğŸ“¦ æ¿€æ´»ç¯å¢ƒ

```bash
conda activate wgs
```

---

æ˜ç™½ï¼æˆ‘å¸®ä½ æ•´ç†ä¸€ä¸ªæ•´ä½“æµç¨‹ï¼Œ**åœ¨â€œæ¯”å¯¹â€è¿™ä¸€æ­¥åªä»‹ç» bwa mem å’Œ minimap2 ä¸¤ç§å¯é€‰æ–¹æ¡ˆåŠå®ƒä»¬çš„ä¼˜ç¼ºç‚¹**ï¼Œåç»­æ­¥éª¤ä¸åŒºåˆ†ä½¿ç”¨å“ªç§æ–¹æ³•ç”Ÿæˆçš„ç»“æœï¼Œç»Ÿä¸€ç”¨ç›¸åŒçš„æ–‡ä»¶å‘½åå’Œæµç¨‹ã€‚è¿™æ ·æ›´ç®€æ´ä¸”æ–¹ä¾¿ç®¡ç†ã€‚

---

# å…¨åŸºå› ç»„é‡æµ‹åºï¼ˆWGSï¼‰åˆ†ææµç¨‹ç¤ºä¾‹

---

## ğŸ—‚ï¸ è¾“å…¥æ–‡ä»¶ç»“æ„

```
raw_fastq/
â”œâ”€â”€ ID001.R1.fq.gz
â”œâ”€â”€ ID001.R2.fq.gz
â”œâ”€â”€ ID002.R1.fq.gz
â”œâ”€â”€ ID002.R2.fq.gz
â”œâ”€â”€ ID003.R1.fq.gz
â”œâ”€â”€ ID003.R2.fq.gz
```

---

## âš™ï¸ å˜é‡è®¾ç½®

```bash
REF=ref/Ovis_aries.fa
THREADS=8
SAMPLES=$(ls raw_fastq/*R1.fq.gz | sed 's/.*\/\(.*\)\.R1\.fq\.gz/\1/')
```

---

## â‘  è´¨æ§å’Œè¿‡æ»¤ï¼š`fastp`

```bash
mkdir -p clean_fastq qc_reports

for sample in $SAMPLES; do
  fastp \
    -i raw_fastq/${sample}.R1.fq.gz \
    -I raw_fastq/${sample}.R2.fq.gz \
    -o clean_fastq/${sample}.R1.clean.fq.gz \
    -O clean_fastq/${sample}.R2.clean.fq.gz \
    -h qc_reports/${sample}.html \
    -j qc_reports/${sample}.json \
    -w $THREADS
done

multiqc qc_reports -o qc_reports/
```

---

## â‘¡ æ¯”å¯¹ï¼ˆä¸¤ç§å¯é€‰æ–¹æ¡ˆï¼‰

### æ–¹æ¡ˆ1ï¼š`bwa mem`

* ç»å…¸çš„çŸ­åºåˆ—æ¯”å¯¹å·¥å…·ï¼Œå‡†ç¡®åº¦é«˜ï¼Œå¹¿æ³›åº”ç”¨äºçŸ­è¯»é•¿ï¼ˆå¦‚Illuminaï¼‰æ•°æ®çš„åŸºå› ç»„æ¯”å¯¹ã€‚
* ä¼˜ç‚¹ï¼šæˆç†Ÿç¨³å®šï¼Œæ”¯æŒå¤šçº¿ç¨‹ï¼Œå¹¿æ³›æ–‡çŒ®æ”¯æŒã€‚
* ç¼ºç‚¹ï¼šå¯¹é«˜å˜å¼‚åŒºåŸŸå’Œè¾ƒé•¿è¯»é•¿æ€§èƒ½ä¸‹é™ã€‚

```bash
bwa index $REF  # ä»…éœ€æ‰§è¡Œä¸€æ¬¡

mkdir -p bam

for sample in $SAMPLES; do
  bwa mem -t $THREADS $REF \
    clean_fastq/${sample}.R1.clean.fq.gz \
    clean_fastq/${sample}.R2.clean.fq.gz | \
    samtools view -bS - > bam/${sample}.bam
done
```

---

### æ–¹æ¡ˆ2ï¼š`minimap2`

* æ–°ä¸€ä»£æ¯”å¯¹å·¥å…·ï¼Œæ”¯æŒçŸ­åºåˆ—å’Œé•¿åºåˆ—æ¯”å¯¹ï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆå¤šç§æµ‹åºæ•°æ®ã€‚
* ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ï¼Œæ”¯æŒé•¿è¯»é•¿ï¼Œé€‚ç”¨èŒƒå›´å¹¿ã€‚
* ç¼ºç‚¹ï¼šå¯¹æŸäº›ç»†èŠ‚æ¯”å¯¹å‡†ç¡®ç‡ç•¥ä½äº bwa memã€‚

```bash
minimap2 -d ref/Ovis_aries.mmi $REF  # ä»…éœ€æ‰§è¡Œä¸€æ¬¡

mkdir -p bam

for sample in $SAMPLES; do
  minimap2 -ax sr -t $THREADS ref/Ovis_aries.mmi \
    clean_fastq/${sample}.R1.clean.fq.gz \
    clean_fastq/${sample}.R2.clean.fq.gz | \
    samtools view -bS - > bam/${sample}.bam
done
```

---

## â‘¢ BAM æ–‡ä»¶å¤„ç†ï¼ˆæ’åº + æ·»åŠ  Read Group + å»é‡ï¼‰

```bash
mkdir -p bam_dedup

for sample in $SAMPLES; do
  samtools sort -@ $THREADS -o bam/${sample}.sorted.bam bam/${sample}.bam

  picard AddOrReplaceReadGroups \
    I=bam/${sample}.sorted.bam \
    O=bam/${sample}.rg.bam \
    RGID=${sample} RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=${sample}

  picard MarkDuplicates \
    I=bam/${sample}.rg.bam \
    O=bam_dedup/${sample}.dedup.bam \
    M=bam_dedup/${sample}.metrics.txt \
    REMOVE_DUPLICATES=true

  samtools index bam_dedup/${sample}.dedup.bam
done
```

---

## â‘£ å˜å¼‚æ£€æµ‹ï¼šè”åˆè°ƒç”¨ SNP/Indel

```bash
mkdir -p vcf

ls bam_dedup/*.dedup.bam > bam_list.txt

bcftools mpileup -Ou -f $REF -b bam_list.txt | \
  bcftools call -mv -Oz -o vcf/variants.raw.vcf.gz

bcftools index vcf/variants.raw.vcf.gz
```

---

## â‘¤ VCF è¿‡æ»¤

```bash
mkdir -p vcf/filtered

bcftools filter -s LOWQUAL -e '%QUAL<30 || DP<5' \
  vcf/variants.raw.vcf.gz -Oz -o vcf/filtered/variants.filtered.vcf.gz

bcftools index vcf/filtered/variants.filtered.vcf.gz
```

---

## â‘¥ SNP æ³¨é‡Šï¼š`SnpEff`

```bash
mkdir -p snpeff_output

snpEff -v Ovis_aries \
  vcf/filtered/variants.filtered.vcf.gz > \
  snpeff_output/variants.ann.vcf
```

---

## â‘¦ VCF è½¬ PLINK æ ¼å¼

```bash
mkdir -p plink

plink --vcf vcf/filtered/variants.filtered.vcf.gz \
  --make-bed --out plink/wgs --allow-extra-chr
```

---

## ğŸ—‚ï¸ è¾“å‡ºç›®å½•ç»“æ„ç¤ºä¾‹

```
clean_fastq/
bam/
bam_dedup/
vcf/
vcf/filtered/
snpeff_output/
plink/
qc_reports/
```

---
